<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>DEMO</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="content">
        <div class="contr">
            <img src="./github.gif" alt="github" id='github' onclick="github()">
            <select name="dragType" id="dragType">
                <option value="default">默认拖拽</option>
                <option value="optimization">优化拖拽</option>
            </select>
        </div>
        <img id="dragElement" src="./kakaxi.jpg" alt="" draggable="true" style="left: 500px;top:100px;">
    </div>
    <script src="./index.js"></script>
    <script>
        window.onload = function() {
            let state = {
                optimizationType:'default',
                type:null, //事件类型
                clientX:0, //
                clientY:0,
                letf:0,
                top:0,
                _w:0,
                _t:0
            }
            let dragDom = document.getElementById('dragElement'); //拖拽元素
            let typeDom = document.getElementById("dragType"); //类型选择元素

            dragDom.addEventListener('mouseenter', drag);
            dragDom.addEventListener('click', drag);
            dragDom.addEventListener('dragstart', drag);
            dragDom.addEventListener('drag', drag);

            typeDom.addEventListener("change", dragType);

            function drag(event) {
                if(!event || (!event.screenX && !event.screenY)) return;
                if(state.optimizationType === 'optimization') {
                    removeGhosting(event)
                }
                state.type = event.type;
                if(['dragstart', 'click'].indexOf(state.type)> -1 ) {
                    state.clientX = event.clientX;
                    state.clientY = event.clientY;
                    state.left = parseInt(dragDom.style.left);
                    state.top = parseInt(dragDom.style.top);
                    state._w = event.clientX - state.left;
                    state._t = event.clientY - state.top;
                }else if(['drag','dragend'].indexOf(state.type)>-1 ) {
                    let left = event.clientX - state.clientX;
                    let top = event.clientY - state.clientY;
                    dragDom.style.left = (state.left + left) +'px';
                    dragDom.style.top = (state.top + top) +'px';
                }
            }
            
            function dragType() {
                if(!typeDom) return;
                let val = typeDom.options[typeDom.selectedIndex].value;
                state.optimizationType = val;
            }
        }
        let github = function() {
            window.location.href='https://github.com/bojue/remove-drag-ghosting'
        }
    </script>
</body>
</html>